<!DOCTYPE html>
<!--
Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or http://ckeditor.com/license
-->

<html>
<link href="../admin/images/skin.css" rel="stylesheet" type="text/css" />
<head>
	<meta charset="utf-8">
	<script src="../admin/js/ckeditor.js"></script>
	<script  src="../js/jquery-1.7.2.min.js"></script>
	<script  src="../js/jsbase64.js"></script>
	<script  src = "../js/json.js"></script>
	
	
	<script>
		var editor, html = '';
		function createEditor() {
			if ( editor ){
				return;
			}
			
			var config = {};
			editor = CKEDITOR.appendTo( 'editor', config, html );
			pase();
		}
		
		var editor11 = CKEDITOR.instances.editor;
 		
		function postss(){
			
			var seconduiid = $("input[name='seconduiid']:checked").val();
			
			var uiid = $("input[name='whichpage']:checked").val();
	        var titleValue =	document.getElementById("title").value;
	        var sortvalue =	document.getElementById("sort").value;
	        var base64 = new Base64();  
	        var srccontent = base64.encode(editor.getData());
	        srccontent = srccontent.replace('+', '_');
	        srccontent = srccontent.replace('/', '-');

			var jsonStr = {seconduiid:seconduiid,sort:sortvalue,uiid:uiid,title:titleValue,content:srccontent};
			jsonStr = JSON.stringify(jsonStr);
			
		    $.post("./news/addnews.do",jsonStr,
		    function(data){
		      if(data.flag == "0"){
		      	alert(data.message);
		      }
		      
		    });
		    
		}
		
		function urlpser(url){
			url = decodeURIComponent(url);
			alert(url);
			var index = url.indexOf("?");
			var jsonstr = url.substr(index+1);
			alert(jsonstr);
			var news = JSON.parse(jsonstr);
			alert(news.title);
			if(news.title!== null && news.title!=""){
				init(news);
			}
			

		}
		function init(news){
			var jsonStr = {seconduiid:"d",sort:"d",uiid:"d",title:news.title,content:"d"};
			jsonStr = JSON.stringify(jsonStr);
			$.post("./news/getnewsbytitle.do",jsonStr,
		    function(data){
		      if(data.flag == "0"){
			        var array = JSON.parse(data.datas);
					alert(array.length);
					if(array.length > 0){
						
						document.getElementById("title").value = array[0].title;
						document.getElementById("sort").value = array[0].sort;
					}
		        
		      }
		      
		    });
			
		
		}
		
		
		function pase(){
			urlpser(this.location.href);
		}
		
	</script>
</head>

<body bgcolor="#F7F8F9" id= mainbody onload ="createEditor()" >

<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td width="17" valign="top" background="../admin/images/mail_leftbg.gif"><img src="../admin/images/left-top-right.gif" width="17" height="29" /></td>
    <td valign="top" background="../admin/images/content-bg.gif"><table width="100%" height="31" border="0" cellpadding="0" cellspacing="0" class="left_topbg" id="table2">
      <tr>
        <td height="31"><div class="titlebt">添加文章</div></td>
      </tr>
    </table></td>
    <td width="16" valign="top" background="../admin/images/mail_rightbg.gif"><img src="../admin/images/nav-right-bg.gif" width="16" height="29" /></td>
</table>

 	<br>
	<br>
	一级模块：
	<input type="radio" onclick="writeSecondMod(this)" name="whichpage" value="home" />网站首页
	<input type="radio" onclick="writeSecondMod(this)" name="whichpage" value="news" /> 新闻中心
	<input type="radio" onclick="writeSecondMod(this)" name="whichpage" value="sucessexample" /> 成功案例
	<input type="radio" onclick="writeSecondMod(this)" name="whichpage" value="ofquestion" /> 常见问题
	<br/>
	
	<script type="text/javascript">
	
		function writeSecondMod(obj){
		if(obj.value == 'home')
   			document.getElementById("secondmod").innerHTML = '<body id = "secondemodd">二级模块：<input type="radio" name="seconduiid" value="newss" />新闻中心<input type="radio" name="seconduiid" value="sucessexamples" />成功案例</body>';
		else
			document.getElementById('secondmod').innerHTML = "";		
		}
	</script>
	<div id="secondmod"> </div>
		<br/>
		文章排序索引：<input id="sort" value="1" size="10" type="text"><br>
	<br>
	<br/>
		标题：<input id="title" size="100" type="text"><br>
	<br>
	<br>
		<div id="editor">
		</div><br>
	<!-- This div will hold the editor. -->
	
		<button size="20" onclick="postss()" id="button">提交发表</button>
		<button size="20" onclick="pase()" id="button1">test</button>
	<br>
	<br>
	<br>
	<br/>
	<br/>
	<br/>
	<br>
	<h1></h1>


</body>

</html>
